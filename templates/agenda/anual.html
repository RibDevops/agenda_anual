{% load agenda_filters %}
<!-- coloque dentro do body, perto do topo -->
<div>
  <button id="btn-png">Exportar PNG</button>
  <a href="{% url 'agenda:gerar_pdf' %}?ano={{ ano }}"><button>Gerar PDF</button></a>
</div>

<!-- coloque o calendário dentro de div com id -->
<div id="calendario">
  
<h1>Agenda {{ ano }}</h1>

<div class="calendario-anual">
{% for mes, semanas in calendario.items %}
<div class="mes-container">
    <h2>{{ mes }}</h2>

    <table class="agenda">
        <tr>
            <th>Dom</th><th>Seg</th><th>Ter</th>
            <th>Qua</th><th>Qui</th><th>Sex</th><th>Sáb</th>
        </tr>

        {% for semana in semanas %}
        <tr>
            {% for dia in semana %}
            <td class="{% if dia.month != mes %}fora-mes{% endif %}">
                <span class="dia-numero">{{ dia.day }}</span>

                {% with eventos=eventos_por_data|get_item:dia %}
                {% if eventos %}
                    <div class="eventos-container">
                    {% for evento in eventos %}
                        <div class="evento {{ evento.cor }}" title="{{ evento.titulo }}">
                            {{ evento.titulo|truncatechars:10 }}
                        </div>
                    {% endfor %}
                    </div>
                {% endif %}
                {% endwith %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>
{% endfor %}
</div>

</div>

<!-- incluir html2canvas via CDN no fim do template -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.getElementById('btn-png').addEventListener('click', function(){
  html2canvas(document.getElementById('calendario'), {scale: 2}).then(function(canvas) {
    var link = document.createElement('a');
    link.download = 'calendario_{{ ano }}.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
});
</script>



{% extends 'base.html' %}
{% load agenda_filters %}

{% block content %}


<div class="calendario-wrapper-95">
    <div class="calendario-anual-horizontal">
        <!-- Coluna de Dias da Semana -->
        <div class="dias-semana-col">
            <div class="header-vazio"></div>
            <div class="dia-label">S</div>
            <div class="dia-label">T</div>
            <div class="dia-label">Q</div>
            <div class="dia-label">Q</div>
            <div class="dia-label">S</div>
            <div class="dia-label">S</div>
            <div class="dia-label">D</div>
        </div>

        {% for mes_nome, linhas_dias in calendario.items %}
        <div class="mes-coluna">
            <div class="mes-nome-header">{{ mes_nome|upper }}</div>
            <div class="mes-grade">
                {% for linha in linhas_dias %}
                <div class="semana-linha">
                    {% for dia in linha %}
                    {% with eventos=eventos_por_data|get_item:dia %}
                    <a href="{% url 'agenda:adicionar_evento' %}?data={{ dia|date:'Y-m-d' }}" 
                       class="dia-celula {% if dia.month_name != mes_nome %}fora-mes{% endif %} {% if eventos %}{% for ev in eventos %}bg-{{ ev.cor }} {% endfor %}{% endif %}"
                       title="{% if eventos %}{% for ev in eventos %}{{ ev.titulo }}{% if not forloop.last %}, {% endif %}{% endfor %}{% else %}{{ dia|date:'d/m/Y' }}{% endif %}">
                        {{ dia.day }}
                    </a>
                    {% endwith %}
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="secoes-container">
    <div class="secao-box">
        <div class="secao-titulo">LEGENDA</div>
        <div class="legenda-item"><div class="cor-box bg-red"></div> FERIADO</div>
        <div class="legenda-item"><div class="cor-box bg-blue"></div> ALTCOM</div>
    </div>
    <div class="secao-box">
        <div class="secao-titulo">PROJETO ATIVI</div>
    </div>
    <div class="secao-box">
        <div class="secao-titulo">G</div>
    </div>
    <div class="secao-box">
        <div class="secao-titulo">FORMATURAS</div>
        {% for e in todos_eventos %}
            {% if e.cor == 'pink' %}
                <div class="legenda-item" style="color: #c00000; font-weight: bold;">
                    {{ e.data|date:"d/m" }} - {{ e.titulo|upper }}
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<div class="mt-4 text-center no-print">
  <button id="btn-png" class="btn btn-secondary">Exportar PNG</button>
  <a href="{% url 'agenda:gerar_pdf' %}?ano={{ ano }}" class="btn btn-primary">Gerar PDF</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.getElementById('btn-png').addEventListener('click', function(){
  html2canvas(document.querySelector('.calendario-wrapper-95'), {scale: 2}).then(function(canvas) {
    var link = document.createElement('a');
    link.download = 'calendario_{{ ano }}.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
});
</script>
{% endblock %}

{% load agenda_filters %}

<div class="calendario-header">
    CALENDÁRIO ANUAL DE ATIVIDADES - {{ ano }}
</div>

<div class="calendario-anual">
{% for mes, semanas in calendario.items %}
<div class="mes-container">
    <div class="mes-nome">{{ mes|upper }}</div>

    <table class="agenda">
        <tr>
            <th>S</th><th>T</th><th>Q</th><th>Q</th><th>S</th><th>S</th><th>D</th>
        </tr>

        {% for semana in semanas %}
        <tr>
            {% for dia in semana %}
            {% with eventos=eventos_por_data|get_item:dia %}
            <td class="{% if dia.month != mes %}fora-mes{% endif %} {% if eventos %}{% for ev in eventos %}bg-{{ ev.cor }} {% endfor %}{% endif %}">
                <span class="dia-numero">{{ dia.day }}</span>
            </td>
            {% endwith %}
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>
{% endfor %}
</div>

<div class="secoes-container">
    <div class="secao-box">
        <div class="secao-titulo">LEGENDA</div>
        <div class="legenda-item"><div class="cor-box bg-red"></div> FERIADO</div>
        <div class="legenda-item"><div class="cor-box bg-blue"></div> ALTCOM</div>
        <!-- Adicionar mais conforme necessário -->
    </div>
    <div class="secao-box">
        <div class="secao-titulo">PROJETO ATIVI</div>
    </div>
    <div class="secao-box">
        <div class="secao-titulo">G</div>
    </div>
    <div class="secao-box">
        <div class="secao-titulo">FORMATURAS</div>
        {% for e in todos_eventos %}
            {% if e.cor == 'pink' %}
                <div class="legenda-item" style="color: #c00000; font-weight: bold;">
                    {{ e.data|date:"d/m" }} - {{ e.titulo|upper }}
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<!-- incluir html2canvas via CDN no fim do template -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.getElementById('btn-png').addEventListener('click', function(){
  html2canvas(document.getElementById('calendario'), {scale: 2}).then(function(canvas) {
    var link = document.createElement('a');
    link.download = 'calendario_{{ ano }}.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
});
</script>


